CREATE OR REPLACE TRIGGER  "TRIGGER_COMPRAS" 
AFTER INSERT ON DCOMPRAS
    FOR EACH ROW
    DECLARE
    NEWSTOCK NUMBER;
    BEGIN
        SELECT STOCK
        INTO NEWSTOCK
        FROM PRODUCTOS
        WHERE ID_PRODUCTO = :NEW.ID_PRODUCTO;

        NEWSTOCK := NEWSTOCK + :NEW.CANTIDAD;

        UPDATE PRODUCTOS
           SET STOCK = NEWSTOCK 
        WHERE ID_PRODUCTO = :NEW.ID_PRODUCTO;

END TRIGGER_COMPRAS;
/

CREATE OR REPLACE TRIGGER  "TRIGGER_VENTAS" 
AFTER INSERT ON DVENTA
    FOR EACH ROW
    DECLARE
    NEWSTOCK NUMBER;
    NEWCOMISION NUMBER;
    PRECIO NUMBER;
    ID_U VARCHAR(20);
    BEGIN
        SELECT STOCK, PRECIO
        INTO NEWSTOCK, PRECIO
        FROM PRODUCTOS
        WHERE ID_PRODUCTO = :NEW.ID_PRODUCTO2;

        NEWSTOCK := NEWSTOCK - :NEW.CANTIDAD;

        UPDATE PRODUCTOS
           SET STOCK = NEWSTOCK 
        WHERE ID_PRODUCTO = :NEW.ID_PRODUCTO2;

	SELECT ID_USUARIO
        INTO ID_U
        FROM VENTAS
        WHERE ID_VENTA = :NEW.ID_VENTA2;
	
	SELECT COMISION
        INTO NEWCOMISION
        FROM USUARIOS
        WHERE RUT = ID_U;

        NEWCOMISION := NEWCOMISION + (:NEW.CANTIDAD * PRECIO / 10);

        UPDATE USUARIOS
           SET COMISION = NEWCOMISION 
        WHERE RUT = ID_U;

END TRIGGER_VENTAS;
/
